/**
 * @license
 * format-to-json v1.0.2
 * GitHub Repository <https://github.com/CN-Tower/format-to-json>
 * Released under MIT license <https://github.com/CN-Tower/format-to-json/blob/master/LICENSE>
 */
"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(root){var fmtSource=void 0,curLevel=void 0,curIndex=void 0,baseIndent=void 0,exceptType=void 0,exceptSign=void 0,signsQueue=void 0,isSrcValid=void 0,isFmtError=void 0,resultOnly=void 0,fmtResult=void 0,fmtType=void 0,fmtSign=void 0,fmtLines=void 0,message=void 0,errFormat=void 0,errNear=void 0,errIndex=void 0,errExpect=void 0,fmtOptions=void 0;var initVariables=function e(t){fmtSource=t;curLevel=0;curIndex=1;exceptType="";exceptSign="";signsQueue="";isSrcValid=true;isFmtError=false;resultOnly=false;fmtResult="";fmtType="info";fmtSign="";fmtLines=0;message="";errFormat=false;errNear="";errIndex=NaN;errExpect="";fmtOptions={indent:2,isExpand:true,isStrict:false,isEscape:false,isUnscape:false,keyQtMark:'"',valQtMark:'"'}};var SPACE=" ";var BREAK="\r\n";var ESCAPES_MAP=[{ptn:/\r\n/gm,str:""},{ptn:/\n\r/gm,str:""},{ptn:/\n/gm,str:"\\n"},{ptn:/\r/gm,str:"\\r"},{ptn:/\f/gm,str:"\\f"},{ptn:/\t/gm,str:"\\t"},{ptn://gm,str:"\\b"},{ptn://gm,str:"\\v"}];var MESSAGES_MAP={ost:function e(t){return"Expect a string in line: "+t},col:function e(t){return"Expect a colon in line: "+t},val:function e(t){return"Invalid value in line: "+t},end:function e(t,r){return'Expect a comma or a "'+r+'" in line: '+t},war:function e(t){return"Formated "+t+" lines, abnormal JSON source!"},scc:function e(t){return"Success formated "+t+" lines!"},err:function e(){return"Parse Error, an excessive abnormal Json!"}};function formatToJson(t,r){return new Promise(function(e){initVariables(t);if(r){if(typeof r.indent==="number"&&r.indent>0){fmtOptions.indent=r.indent}if(typeof r.resultOnly==="boolean"){resultOnly=r.resultOnly}if(typeof r.isExpand==="boolean"){fmtOptions.isExpand=r.isExpand}if(typeof r.isStrict==="boolean"){fmtOptions.isStrict=r.isStrict}if(typeof r.isEscape==="boolean"){fmtOptions.isEscape=r.isEscape}if(typeof r.isUnscape==="boolean"){fmtOptions.isUnscape=r.isUnscape}if(["'",'"',""].indexOf(r.keyQtMark)>-1){fmtOptions.keyQtMark=r.keyQtMark}if(["'",'"'].indexOf(r.valQtMark)>-1){fmtOptions.valQtMark=r.valQtMark}}baseIndent=getBaseIndent();doFormatBytry(e)})}function doFormatBytry(resolve){try{try{if(fmtSource!=="")eval("fmtSource = "+fmtSource);if(fmtSource===""||["object","boolean"].indexOf(typeof fmtSource==="undefined"?"undefined":_typeof(fmtSource))>-1){doNormalFormat(fmtSource)}else{if(fmtOptions.isUnscape){fmtSource=fmtSource.replace(/\\"/gm,'"').replace(/\\\\/gm,"\\")}doSpecialFormat()}}catch(e){if(fmtOptions.isUnscape){fmtSource=fmtSource.replace(/\\"/gm,'"').replace(/\\\\/gm,"\\")}doSpecialFormat()}}catch(e){isFmtError=true}finally{setFmtStatus();resolve(resultOnly?fmtResult:{result:fmtResult,status:{fmtType:fmtType,fmtSign:fmtSign,fmtLines:fmtLines,message:message,errFormat:errFormat,errIndex:errIndex,errExpect:errExpect,errNear:errNear}})}}function doNormalFormat(e){if([true,false,null,""].indexOf(e)>-1){return fmtResult+=String(e)}if(fmtOptions.isStrict){e=JSON.parse(JSON.stringify(e))}e instanceof Array?arrayHandler(e):objectHandler(e)}function arrayHandler(e){var t=void 0;if(e.length>0){fmtResult+=brkLine4Normal("[");if(fmtOptions.isExpand)curIndex++;curLevel++;for(var r=0;r<e.length;r++){t=fmtOptions.isExpand?getCurIndent():"";fmtResult+=t;valueHandler(e[r]);fmtResult+=brkLine4Normal(r<e.length-1?",":"")}curLevel--;t=fmtOptions.isExpand?getCurIndent():"";fmtResult+=t+"]"}else{fmtResult+="[]"}}function objectHandler(e){var t=Object.keys(e);if(t.length>0){var r=void 0,n=0;fmtResult+=brkLine4Normal("{");curLevel++;for(var s in e){n++;var c=quoteNormalStr(s,fmtOptions.keyQtMark);r=fmtOptions.isExpand?getCurIndent():"";fmtResult+=r;fmtResult+=c;fmtResult+=fmtOptions.isExpand?": ":":";valueHandler(e[s]);fmtResult+=brkLine4Normal(n<t.length?",":"")}curLevel--;r=fmtOptions.isExpand?getCurIndent():"";fmtResult+=r+"}"}else{fmtResult+="{}"}}function valueHandler(e){switch(typeof e==="undefined"?"undefined":_typeof(e)){case"undefined":case"function":return fmtResult+=String(e);case"number":case"boolean":return fmtResult+=e;case"object":return doNormalFormat(e);case"string":return fmtResult+=quoteNormalStr(e,fmtOptions.valQtMark)}}function doSpecialFormat(){fmtSource=fmtSource.replace(/^\s*/,"");if(fmtSource.length===0)return;var e=false;switch(fmtSource[0]){case"'":case'"':e=true;quotaHandler();break;case":":e=true;colonHandler();break;case",":e=true;commaHandler();break;case"{":e=true;objPreHandler();break;case"}":e=true;objEndHandler();break;case"[":e=true;arrPreHandler();break;case"]":e=true;arrEndHandler();break;case"(":e=true;tupPreHandler();break;case")":e=true;tupEndHandler();break}if(!e){var t=fmtSource.match(/^u(\s)?'|^u(\s)?"/);if(t){e=true;unicHandler(t[0])}}if(!e){var r=fmtSource.match(/^(-?[0-9]+\.?[0-9]*|0[xX][0-9a-fA-F]+)/);if(r){e=true;numbHandler(r[0])}}if(!e){var n=fmtSource.match(/^(true|false|True|False)/);if(n){e=true;boolHandler(n[0])}}if(!e){var s=fmtSource.match(/^(null|undefined|None|NaN)/);if(s){e=true;nullHandler(s[0])}}if(!e)otheHandler();return doSpecialFormat()}function quotaHandler(){var e=getSrcRest();var t=getNextQuotaIndex(fmtSource[0],e);chkFmtExpect(fmtSource[0]);var r=fmtSource.substr(0,1);var n=exceptType==="ost";var s="";if(t>-1){s=fmtSource.substr(1,t);fmtResult+=quoteSpecialStr(s,r,n);setFmtExpect(fmtSource[0]);fmtSource=getSrcRest(t+2)}else{s=fmtSource.substr(1);fmtResult+=quoteSpecialStr(s,r,n);setFmtExpect("!");fmtSource=""}}function colonHandler(){fmtResult+=fmtOptions.isExpand?": ":":";chkFmtExpect(fmtSource[0]);setFmtExpect(fmtSource[0]);fmtSource=getSrcRest()}function commaHandler(){var e=getCurIndent();if(fmtOptions.isExpand)curIndex++;fmtResult+=fmtOptions.isExpand?","+(BREAK+e):",";chkFmtExpect(fmtSource[0]);setFmtExpect(fmtSource[0]);fmtSource=getSrcRest();if(fmtSource.replace(/(\r)?\n|\s/gm,"")==="")setFmtError("val")}function objPreHandler(){chkFmtExpect(fmtSource[0]);setFmtExpect(fmtSource[0]);if(fmtSource[1]&&fmtSource[1]==="}"){fmtResult+="{}";setFmtExpect("}");fmtSource=getSrcRest(2)}else{curLevel++;fmtResult+="{";brkLine4Special();fmtSource=getSrcRest()}}function objEndHandler(){curLevel--;brkLine4Special("}");chkFmtExpect(fmtSource[0]);setFmtExpect(fmtSource[0]);fmtSource=getSrcRest()}function arrPreHandler(){chkFmtExpect(fmtSource[0]);setFmtExpect(fmtSource[0]);if(fmtSource[1]&&fmtSource[1]==="]"){fmtResult+="[]";setFmtExpect("]");fmtSource=getSrcRest(2)}else{curLevel++;fmtResult+="[";brkLine4Special();fmtSource=getSrcRest()}}function arrEndHandler(){curLevel--;brkLine4Special("]");chkFmtExpect(fmtSource[0]);setFmtExpect(fmtSource[0]);fmtSource=getSrcRest()}function tupPreHandler(){chkFmtExpect(fmtSource[0]);setFmtExpect(fmtSource[0]);if(fmtSource[1]&&fmtSource[1]===")"){fmtResult+=fmtOptions.isStrict?"[]":"()";setFmtExpect(")");fmtSource=getSrcRest(2)}else{curLevel++;fmtResult+=fmtOptions.isStrict?"[":"(";brkLine4Special();fmtSource=getSrcRest()}}function tupEndHandler(){curLevel--;brkLine4Special(fmtOptions.isStrict?"]":")");chkFmtExpect(fmtSource[0]);setFmtExpect(fmtSource[0]);fmtSource=getSrcRest()}function unicHandler(e){var t=getSrcRest(e.length);var r=e.indexOf("'")>-1?getNextQuotaIndex("'",t):getNextQuotaIndex('"',t);chkFmtExpect("u");var n=exceptType==="ost";var s="";if(r>-1){var c=r+e.length+1;s=fmtSource.substr(e.length,c-e.length-1);fmtResult+=quoteSpecialStr(s,e,n);setFmtExpect("u");fmtSource=getSrcRest(c)}else{s=fmtSource.substr(e.length);fmtResult+=quoteSpecialStr(s,e,n);setFmtExpect("!");fmtSource=""}}function numbHandler(e){fmtResult+=e;chkFmtExpect("n");setFmtExpect("n");fmtSource=getSrcRest(e.length)}function boolHandler(e){fmtResult+=fmtOptions.isStrict?e.toLowerCase():e;chkFmtExpect("b");setFmtExpect("b");fmtSource=getSrcRest(e.length)}function nullHandler(e){fmtResult+=fmtOptions.isStrict?"null":e;chkFmtExpect("N");setFmtExpect("N");fmtSource=getSrcRest(e.length)}function otheHandler(){var e=fmtSource.match(/^[^\{\}\[\]\(\):,]*/);var t=e&&e[0]||"";if(t){fmtResult+=t;chkFmtExpect("!");fmtSource=getSrcRest(t.length)}}function chkFmtExpect(e){if(isSrcValid){switch(exceptType){case"val":if(":,}])!".indexOf(e)>-1){setFmtError("val")}break;case"ost":if("'\"unbN".indexOf(e)===-1){setFmtError("ost")}break;case"end":var t=getBracketPair(exceptSign);if([",",t].indexOf(e)===-1){setFmtError("end",t)}break;case"col":if(e!==":"){setFmtError("col")}break}}}function setFmtExpect(e){switch(e){case":":exceptType="val";break;case",":exceptSign==="{"?exceptType="ost":exceptType="val";break;case"{":exceptSign=e;signsQueue+=e;exceptType="ost";break;case"}":signsQueue=signsQueue.substr(0,signsQueue.length-1);exceptSign=signsQueue.substr(-1);exceptType="end";break;case"[":exceptSign=e;signsQueue+=e;exceptType="val";break;case"]":signsQueue=signsQueue.substr(0,signsQueue.length-1);exceptSign=signsQueue.substr(-1);exceptType="end";break;case"(":exceptSign=e;signsQueue+=e;exceptType="val";break;case")":signsQueue=signsQueue.substr(0,signsQueue.length-1);exceptSign=signsQueue.substr(-1);exceptType="end";break;case"u":case"n":case"b":case"N":case'"':case"'":exceptType==="ost"?exceptType="col":exceptType="end";break}}function setFmtError(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";switch(e){case"war":fmtType="warning";break;case"scc":fmtType="success";break;default:fmtType="danger";break}if(["ost","col","val","end"].indexOf(e)>-1){errFormat=true;isSrcValid=false;errExpect=t;errIndex=curIndex;console.log(fmtResult);console.log(fmtSource);var r=fmtResult.substr(-20).replace(/^(\s|\n|\r\n)*/,"").replace(/(\n|\r\n)/gm,"\\n");var n=fmtSource.substr(0,10).replace(/(\s|\n|\r\n)*$/,"").replace(/(\n|\r\n)/gm,"\\n");errNear="..."+r+">>>>>>"+n}fmtSign=e;message=MESSAGES_MAP[e](curIndex,t)}function setFmtStatus(){if(isFmtError&&!errIndex){setFmtError("err");errFormat=true}else if(isSrcValid){if(signsQueue){var e=getBracketPair(signsQueue.substr(-1));setFmtError("end",e)}setFmtError("scc")}fmtLines=curIndex}function brkLine4Normal(e){if(!fmtOptions.isExpand)return e;curIndex++;return e+BREAK}function brkLine4Special(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";if(!fmtOptions.isExpand)return fmtResult+=e;curIndex++;fmtResult+=BREAK+getCurIndent()+e}function quoteNormalStr(t,e){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var n=fmtOptions.isEscape&&fmtOptions.keyQtMark==='"'&&e==='"'&&(!r||fmtOptions.isStrict);t=r?t.replace(/(?!\\[b|f|n|\\|r|t|x|v|'|"|0])\\/gm,"\\\\"):t.replace(/\\/gm,"\\\\");ESCAPES_MAP.forEach(function(e){return t=t.replace(e.ptn,e.str)});var s=n?"\\"+e:e;if(n)t=t.replace(/\\/gm,"\\\\");switch(e){case'"':t=n?t.replace(/"/gm,'\\\\\\"'):t.replace(/"/gm,'\\"');return s+t+s;case"'":t=t.replace(/'/gm,"\\'");return s+t+s;default:return t}}function quoteSpecialStr(e,t,r){var n=r?fmtOptions.keyQtMark:fmtOptions.valQtMark;e=e.replace(/(?!\\[b|f|n|\\|r|t|x|v|'|"|0])\\/gm,"");e=e.replace(/\\\"/gm,'"');e=e.replace(/\\\'/gm,"'");e=quoteNormalStr(e,n,true);if(!fmtOptions.isStrict&&t.length>1){e=t.substr(0,t.length-1)+e}return e}function getSrcRest(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return fmtSource.length>e?fmtSource.substr(e):""}function getNextQuotaIndex(e,t){for(var r=0;r<t.length;r++){if(t[r]===e){if(r===0||t[r-1]!=="\\"||t[r-1]==="\\"&&t[r-2]==="\\"&&t[r-3]!=="\\"){return r}}}return-1}function getBaseIndent(){var e="";for(var t=0;t<fmtOptions.indent;t++){e+=SPACE}return e}function getCurIndent(){var e="";for(var t=0;t<curLevel;t++){e+=baseIndent}return e}function getBracketPair(e){var t=["{","[","("];var r=["}","]",")"];var n=t.indexOf(e);var s=r.indexOf(e);return n>-1?r[n]:t[s]}if(typeof define==="function"&&define.amd){define(function(){return formatToJson})}else if((typeof exports==="undefined"?"undefined":_typeof(exports))==="object"){module.exports=formatToJson}else{root.formatToJson=formatToJson}})(this);