/**
 * @license
 * format-to-json v1.0.1
 * GitHub Repository <https://github.com/CN-Tower/format-to-json>
 * Released under MIT license <https://github.com/CN-Tower/format-to-json/blob/master/LICENSE>
 */
"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(root){var srcString=void 0,curLevel=void 0,curIndex=void 0,baseIndent=void 0,exceptType=void 0,exceptSign=void 0,signsQueue=void 0,isSrcValid=void 0,isFmtError=void 0,resultOnly=void 0,fmtResult=void 0,fmtSign=void 0,fmtType=void 0,fmtLines=void 0,message=void 0,errFormat=void 0,errNear=void 0,errIndex=void 0,errExpect=void 0,fmtOptions=void 0;var initVariables=function e(t){srcString=t;curLevel=0;curIndex=1;exceptType="";exceptSign="";signsQueue="";isSrcValid=true;isFmtError=false;resultOnly=false;fmtResult="";fmtSign="";fmtType="info";fmtLines=0;message="";errFormat=false;errNear="";errIndex=NaN;errExpect="";fmtOptions={indent:2,isExpand:true,isStrict:false,isEscape:false,keyQtMark:'"',valQtMark:'"'};baseIndent=getBaseIndent()};var SPACE=" ";var BREAK="\r\n";var ESCAPES_MAP=[{ptn:/\r\n/gm,str:""},{ptn:/\n\r/gm,str:""},{ptn:/\n/gm,str:"\\n"},{ptn:/\r/gm,str:"\\r"},{ptn:/\f/gm,str:"\\f"},{ptn:/\t/gm,str:"\\t"},{ptn://gm,str:"\\b"},{ptn://gm,str:"\\v"}];var MESSAGES_MAP={ost:function e(t){return"Expect a string in line: "+t},col:function e(t){return"Expect a colon in line: "+t},val:function e(t){return"Invalid value in line: "+t},end:function e(t,r){return'Expect a comma or a "'+r+'" in line: '+t},war:function e(t){return"Formated "+t+" lines, abnormal JSON source!"},scc:function e(t){return"Success formated "+t+" lines!"},err:function e(){return"Parse Error, an excessive abnormal Json!"}};function formatToJson(source,options){return new Promise(function(resolve){initVariables(source);if(options){if(typeof options.indent==="number"&&options.indent>0){fmtOptions.indent=options.indent}if(typeof options.resultOnly==="boolean"){resultOnly=options.resultOnly}if(typeof options.isExpand==="boolean"){fmtOptions.isExpand=options.isExpand}if(typeof options.isStrict==="boolean"){fmtOptions.isStrict=options.isStrict}if(typeof options.isEscape==="boolean"){fmtOptions.isEscape=options.isEscape}if(["'",'"',""].includes(options.keyQtMark)){fmtOptions.keyQtMark=options.keyQtMark}if(["'",'"',""].includes(options.valQtMark)){fmtOptions.valQtMark=options.valQtMark}}try{try{if(srcString!=="")eval("srcString = "+srcString);if(srcString===""||["object","boolean"].includes(typeof srcString==="undefined"?"undefined":_typeof(srcString))){doNormalFormat(srcString)}else{doSpecialFormat()}}catch(e){doSpecialFormat()}}catch(e){isFmtError=true}finally{setFmtStatus();resolve(resultOnly?fmtResult:{fmtResult:fmtResult,fmtSign:fmtSign,fmtType:fmtType,fmtLines:fmtLines,message:message,errFormat:errFormat,errNear:errNear,errIndex:errIndex,errExpect:errExpect})}})}function doNormalFormat(e){if([true,false,null,""].includes(e)){return fmtResult+=String(e)}if(fmtOptions.isStrict){e=JSON.parse(JSON.stringify(e))}e instanceof Array?arrayHandler(e):objectHandler(e)}function arrayHandler(e){var t=void 0;if(e.length>0){fmtResult+=brkLine4Normal("[");if(fmtOptions.isExpand)curIndex++;curLevel++;for(var r=0;r<e.length;r++){t=fmtOptions.isExpand?getCurIndent():"";fmtResult+=t;valueHandler(e[r]);fmtResult+=brkLine4Normal(r<e.length-1?",":"")}curLevel--;t=fmtOptions.isExpand?getCurIndent():"";fmtResult+=t+"]"}else{fmtResult+="[]"}}function objectHandler(e){var t=void 0;if(Object.keys(e).length>0){fmtResult+=brkLine4Normal("{");curLevel++;var r=0;var n=Object.keys(e);for(var s in e){r++;var i=quoteNormalStr(s,fmtOptions,fmtOptions.keyQtMark);t=fmtOptions.isExpand?getCurIndent():"";fmtResult+=t;fmtResult+=i;fmtResult+=fmtOptions.isExpand?": ":":";valueHandler(e[s]);fmtResult+=brkLine4Normal(r<n.length?",":"")}curLevel--;t=fmtOptions.isExpand?getCurIndent():"";fmtResult+=t+"}"}else{fmtResult+="{}"}}function valueHandler(e){switch(typeof e==="undefined"?"undefined":_typeof(e)){case"undefined":case"function":return fmtResult+=String(e);case"number":case"boolean":return fmtResult+=e;case"object":return doNormalFormat(e);case"string":return fmtResult+=quoteNormalStr(e,fmtOptions,fmtOptions.valQtMark)}}function doSpecialFormat(){srcString=srcString.replace(/^\s*/,"");if(srcString.length===0)return;var e=false;switch(srcString[0]){case"'":case'"':e=true;quotaHandler();break;case":":e=true;colonHandler();break;case",":e=true;commaHandler();break;case"{":e=true;objPreHandler();break;case"}":e=true;objEndHandler();break;case"[":e=true;arrPreHandler();break;case"]":e=true;arrEndHandler();break;case"(":e=true;tupPreHandler();break;case")":e=true;tupEndHandler();break}if(!e){var t=srcString.match(/^u(\s)?'|^u(\s)?"/);if(t){e=true;unicHandler(t[0])}}if(!e){var r=srcString.match(/^(-?[0-9]+\.?[0-9]*|0[xX][0-9a-fA-F]+)/);if(r){e=true;numbHandler(r[0])}}if(!e){var n=srcString.match(/^(true|false|True|False)/);if(n){e=true;boolHandler(n[0])}}if(!e){var s=srcString.match(/^(null|undefined|None|NaN)/);if(s){e=true;nullHandler(s[0])}}if(!e)otheHandler();return doSpecialFormat()}function quotaHandler(){if(srcString[0]==="'")isSrcJson=false;var e=getSrcRest();var t=getNextQuotaIndex(srcString[0],e);chkFmtExpect(srcString[0]);var r=srcString.substr(0,1);var n=exceptType==="ost";var s="";if(t>-1){s=srcString.substr(1,t);fmtResult+=quoteSpecialStr(s,fmtOptions,r,n);setFmtExpect(srcString[0]);srcString=getSrcRest(t+2)}else{s=srcString.substr(1);fmtResult+=quoteSpecialStr(s,fmtOptions,r,n);setFmtExpect("!");srcString=""}}function colonHandler(){fmtResult+=fmtOptions.isExpand?": ":":";chkFmtExpect(srcString[0]);setFmtExpect(srcString[0]);srcString=getSrcRest()}function commaHandler(){var e=getCurIndent();if(fmtOptions.isExpand)curIndex++;fmtResult+=fmtOptions.isExpand?","+(BREAK+e):",";chkFmtExpect(srcString[0]);setFmtExpect(srcString[0]);srcString=getSrcRest();if(srcString.replace(/(\r)?\n|\s/gm,"")==="")setFmtError("val")}function objPreHandler(){chkFmtExpect(srcString[0]);setFmtExpect(srcString[0]);if(srcString[1]&&srcString[1]==="}"){fmtResult+="{}";setFmtExpect("}");srcString=getSrcRest(2)}else{curLevel++;fmtResult+="{";brkLine4Special();srcString=getSrcRest()}}function objEndHandler(){curLevel--;brkLine4Special("}");chkFmtExpect(srcString[0]);setFmtExpect(srcString[0]);srcString=getSrcRest()}function arrPreHandler(){chkFmtExpect(srcString[0]);setFmtExpect(srcString[0]);if(srcString[1]&&srcString[1]==="]"){fmtResult+="[]";setFmtExpect("]");srcString=getSrcRest(2)}else{curLevel++;fmtResult+="[";brkLine4Special();srcString=getSrcRest()}}function arrEndHandler(){curLevel--;brkLine4Special("]");chkFmtExpect(srcString[0]);setFmtExpect(srcString[0]);srcString=getSrcRest()}function tupPreHandler(){chkFmtExpect(srcString[0]);setFmtExpect(srcString[0]);if(srcString[1]&&srcString[1]===")"){fmtResult+=fmtOptions.isStrict?"[]":"()";setFmtExpect(")");srcString=getSrcRest(2)}else{curLevel++;fmtResult+=fmtOptions.isStrict?"[":"(";brkLine4Special();srcString=getSrcRest()}}function tupEndHandler(){curLevel--;brkLine4Special(fmtOptions.isStrict?"]":")");chkFmtExpect(srcString[0]);setFmtExpect(srcString[0]);srcString=getSrcRest()}function unicHandler(e){var t=getSrcRest(e.length);var r=e.indexOf("'")>-1?getNextQuotaIndex("'",t):getNextQuotaIndex('"',t);chkFmtExpect("u");var n=exceptType==="ost";var s="";if(r>-1){var i=r+e.length+1;s=srcString.substr(e.length,i-e.length-1);fmtResult+=quoteSpecialStr(s,fmtOptions,e,n);setFmtExpect("u");srcString=getSrcRest(i)}else{s=srcString.substr(e.length);fmtResult+=quoteSpecialStr(s,fmtOptions,e,n);setFmtExpect("!");srcString=""}}function numbHandler(e){fmtResult+=e;chkFmtExpect("n");setFmtExpect("n");srcString=getSrcRest(e.length)}function boolHandler(e){fmtResult+=fmtOptions.isStrict?e.toLowerCase():e;chkFmtExpect("b");setFmtExpect("b");srcString=getSrcRest(e.length)}function nullHandler(e){fmtResult+=fmtOptions.isStrict?"null":e;chkFmtExpect("N");setFmtExpect("N");srcString=getSrcRest(e.length)}function otheHandler(){var e=srcString.match(/^[^\{\}\[\]\(\):,]*/);var t=e&&e[0]||"";if(t){fmtResult+=t;chkFmtExpect("!");srcString=getSrcRest(t.length)}}function chkFmtExpect(e){if(isSrcValid){switch(exceptType){case"val":if(":,}])!".includes(e)){setFmtError("val")}break;case"ost":if(!"'\"unbN".includes(e)){setFmtError("ost")}break;case"end":var t=getBracketPair(exceptSign);if(![",",t].includes(e)){setFmtError("end",t)}break;case"col":if(e!==":"){setFmtError("col")}break}}}function setFmtExpect(e){switch(e){case":":exceptType="val";break;case",":exceptSign==="{"?exceptType="ost":exceptType="val";break;case"{":exceptSign=e;signsQueue+=e;exceptType="ost";break;case"}":signsQueue=signsQueue.substr(0,signsQueue.length-1);exceptSign=signsQueue.substr(-1);exceptType="end";break;case"[":exceptSign=e;signsQueue+=e;exceptType="val";break;case"]":signsQueue=signsQueue.substr(0,signsQueue.length-1);exceptSign=signsQueue.substr(-1);exceptType="end";break;case"(":exceptSign=e;signsQueue+=e;exceptType="val";break;case")":signsQueue=signsQueue.substr(0,signsQueue.length-1);exceptSign=signsQueue.substr(-1);exceptType="end";break;case"u":case"n":case"b":case"N":case'"':case"'":exceptType==="ost"?exceptType="col":exceptType="end";break}}function setFmtError(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";switch(e){case"war":fmtType="warning";break;case"scc":fmtType="success";break;default:fmtType="danger";break}if(["ost","col","val","end"].includes(e)){isSrcValid=false;errExpect=t;errIndex=curIndex}fmtSign=e}function setFmtStatus(){if(isFmtError&&!errIndex){setFmtError("err");errFormat=true}else if(isSrcValid){if(signsQueue){var e=getBracketPair(signsQueue.substr(-1));setFmtError("end",e)}setFmtError("scc")}fmtLines=curIndex}function brkLine4Normal(e){if(!fmtOptions.isExpand)return e;curIndex++;return e+BREAK}function brkLine4Special(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";if(!fmtOptions.isExpand)return fmtResult+=e;curIndex++;fmtResult+=BREAK+getCurIndent()+e}function quoteNormalStr(t,e,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var s=e.isEscape&&e.keyQtMark==='"'&&r==='"'&&(!n||e.isStrict);t=n?t.replace(/(?!\\[b|f|n|\\|r|t|x|v|'|"|0])\\/gm,"\\\\"):t.replace(/\\/gm,"\\\\");ESCAPES_MAP.forEach(function(e){return t=t.replace(e.ptn,e.str)});var i=s?"\\"+r:r;if(s)t=t.replace(/\\/gm,"\\\\");switch(r){case'"':t=s?t.replace(/"/gm,'\\\\\\"'):t.replace(/"/gm,'\\"');return i+t+i;case"'":t=t.replace(/'/gm,"\\'");return i+t+i;default:return t}}function quoteSpecialStr(e,t,r,n){var s=n?t.keyQtMark:t.valQtMark;e=e.replace(/(?!\\[b|f|n|\\|r|t|x|v|'|"|0])\\/gm,"");e=e.replace(/\\\"/gm,'"');e=e.replace(/\\\'/gm,"'");e=quoteNormalStr(e,t,s,true);if(!t.isStrict&&r.length>1){e=r.substr(0,r.length-1)+e}return e}function getSrcRest(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return srcString.length>e?srcString.substr(e):""}function getNextQuotaIndex(e,t){for(var r=0;r<t.length;r++){if(t[r]===e){if(r===0||t[r-1]!=="\\"||t[r-1]==="\\"&&t[r-2]==="\\"&&t[r-3]!=="\\"){return r}}}return-1}function getBaseIndent(){var e="";for(var t=0;t<fmtOptions.indent;t++){e+=SPACE}return e}function getCurIndent(){var e="";for(var t=0;t<curLevel;t++){e+=baseIndent}return e}function getBracketPair(e){var t=["{","[","("];var r=["}","]",")"];var n=t.indexOf(e);var s=r.indexOf(e);return n>-1?r[n]:t[s]}if(typeof define==="function"&&define.amd){define(function(){return formatToJson})}else if((typeof exports==="undefined"?"undefined":_typeof(exports))==="object"){module.exports=formatToJson}else{root.formatToJson=formatToJson}})(this);